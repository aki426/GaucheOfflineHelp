<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html401/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=Shift_JIS">

<title>11.8 dbm - 汎用DBMインタフェース</title>

<meta name="description" content="Gauche ユーザリファレンス: 11.8 dbm - 汎用DBMインタフェース">
<meta name="keywords" content="Gauche ユーザリファレンス: 11.8 dbm - 汎用DBMインタフェース">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="texi2html 1.82">





<link rel="stylesheet" type="text/css" href="gauche-refj_134.css" media="all">
</head>
<body alink="#FF0000" bgcolor="#FFFFFF" lang="ja" link="#0000FF" text="#000000" vlink="#800080">

<a name="g_t_00e6_00b1_008e_00e7_0094_00a8DBM_00e3_0082_00a4_00e3_0083_00b3_00e3_0082_00bf_00e3_0083_0095_00e3_0082_00a7_00e3_0083_00bc_00e3_0082_00b9"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tbody><tr><td align="left" valign="middle">[<a indepth="true" href="gauche-refj_133.html#DBI_00e7_0094_00a8_00e3_0081_00ae_00e3_0083_0089_00e3_0083_00a9_00e3_0082_00a4_00e3_0083_0090_00e3_0082_0092_00e6_009b_00b8_00e3_0081_008f" title="Previous section in reading order"> &lt; </a>]</td>
<td align="left" valign="middle">[<a href="#DBM_00e3_0083_0087_00e3_0083_00bc_00e3_0082_00bf_00e3_0083_0099_00e3_0083_00bc_00e3_0082_00b9_00e3_0081_00ae_00e3_0082_00aa_00e3_0083_00bc_00e3_0083_0097_00e3_0083_00b3_00e3_0081_00a8_00e3_0082_00af_00e3_0083_00ad_00e3_0083_00bc_00e3_0082_00ba" title="Next section in reading order"> &gt; </a>]</td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_126.html#g_t_00e3_0083_00a9_00e3_0082_00a4_00e3_0083_0096_00e3_0083_00a9_00e3_0083_00aa_00e3_0083_00a2_00e3_0082_00b8_00e3_0083_00a5_00e3_0083_00bc_00e3_0083_00ab-_002d-_00e3_0083_00a6_00e3_0083_00bc_00e3_0083_0086_00e3_0082_00a3_00e3_0083_00aa_00e3_0083_0086_00e3_0082_00a3" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_126.html#g_t_00e3_0083_00a9_00e3_0082_00a4_00e3_0083_0096_00e3_0083_00a9_00e3_0083_00aa_00e3_0083_00a2_00e3_0082_00b8_00e3_0083_00a5_00e3_0083_00bc_00e3_0083_00ab-_002d-_00e3_0083_00a6_00e3_0083_00bc_00e3_0083_0086_00e3_0082_00a3_00e3_0083_00aa_00e3_0083_0086_00e3_0082_00a3" title="Up section"> Up </a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_189.html#g_t_00e5_008f_0082_00e8_0080_0083_00e6_0096_0087_00e7_008c_00ae" title="Next chapter"> &gt;&gt; </a>]</td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj.html#Top" title="Cover (top) of document">Top</a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_191.html#Index-_002d-_00e6_0089_008b_00e7_00b6_009a_00e3_0081_008d_00e3_0081_00a8_00e6_00a7_008b_00e6_0096_0087_00e7_00b4_00a2_00e5_00bc_0095" title="Index">Index</a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></tbody></table>
<a name="dbm-_002d-_00e6_00b1_008e_00e7_0094_00a8DBM_00e3_0082_00a4_00e3_0083_00b3_00e3_0082_00bf_00e3_0083_0095_00e3_0082_00a7_00e3_0083_00bc_00e3_0082_00b9"></a>
<h2 class="section">11.8 <code>dbm</code> - 汎用DBMインタフェース</h2>

<dl>
<dt><a name="index-dbm"></a><u>Module:</u> <b>dbm</b></dt>
<dd><a name="index-dbm-1"></a>
<p>DBM系のライブラリはキーでインデックスされた値をファイルに格納する簡単な方法を
提供します。一種の永続的な連想記憶と言えるでしょう。
</p>
<p>このモジュールが定義する抽象クラス<code>&lt;dbm&gt;</code>は、DBM系ライブラリへの
統一されたインタフェースを提供します。<code>dbm</code>モジュールだけをインポートすれば、
既にオープンされたデータベースを操作することができます。
</p>
<p>データベースをオープンしたり作成したりするには、dbmインタフェースを実装した
モジュールが必要になります。今のところGaucheでは以下の実装が使えます。
それぞれのモジュールは、dbmインタフェース共通の手続きの他に、
直接実装を操作できる低レベルの手続きも提供します。
システムによっては以下のインタフェースの全てが実装されているわけではないことに
注意してください。Gaucheではシステムが提供する実装のみを定義します。
</p>
<dl compact="compact">
<dt> <code>dbm.fsdbm</code></dt>
<dd><p>ファイルシステムdbm (<a indepth="true" href="gauche-refj_135.html#g_t_00e3_0083_0095_00e3_0082_00a1_00e3_0082_00a4_00e3_0083_00ab_00e3_0082_00b7_00e3_0082_00b9_00e3_0083_0086_00e3_0083_00a0dbm"><code>dbm.fsdbm</code> - ファイルシステムdbm</a>参照).
</p>
</dd>
<dt> <code>dbm.gdbm</code></dt>
<dd><p>GDBMライブラリ (<a indepth="true" href="gauche-refj_136.html#GDBM_00e3_0082_00a4_00e3_0083_00b3_00e3_0082_00bf_00e3_0083_0095_00e3_0082_00a7_00e3_0083_00bc_00e3_0082_00b9"><code>dbm.gdbm</code> - GDBMインタフェース</a>参照).
</p>
</dd>
<dt> <code>dbm.ndbm</code></dt>
<dd><p>NDBMライブラリ (<a indepth="true" href="gauche-refj_137.html#NDBM_00e3_0082_00a4_00e3_0083_00b3_00e3_0082_00bf_00e3_0083_0095_00e3_0082_00a7_00e3_0083_00bc_00e3_0082_00b9"><code>dbm.ndbm</code> - NDBMインタフェース</a>参照).
</p>
</dd>
<dt> <code>dbm.odbm</code></dt>
<dd><p>DBMライブラリ  (<a indepth="true" href="gauche-refj_138.html#g_t_00e3_0082_00aa_00e3_0083_00aa_00e3_0082_00b8_00e3_0083_008a_00e3_0083_00ab_00e3_0081_00aeDBM_00e3_0082_00a4_00e3_0083_00b3_00e3_0082_00bf_00e3_0083_0095_00e3_0082_00a7_00e3_0083_00bc_00e3_0082_00b9"><code>dbm.odbm</code> - オリジナルのDBMインタフェース</a>参照).
</p></dd>
</dl>
</dd></dl>

<p>以下にdbmデータベースの使用例を示します。
</p>
<table><tbody><tr><td>&nbsp;</td><td><pre class="example">(use dbm)         ; <span class="roman">dbm abstract interface</span>
(use dbm.gdbm)    ; <span class="roman">dbm concrete interface</span>

; <span class="roman">open the database</span>
(define *db* (dbm-open &lt;gdbm&gt; :path "mydb" :rw-mode :write))

; <span class="roman">put the value to the database</span>
(dbm-put! *db* "key1" "value1")

; <span class="roman">get the value from the database</span>
(define val (dbm-get *db* "key1"))

; <span class="roman">iterate over the database</span>
(dbm-for-each *db* (lambda (key val) (foo key val)))

; <span class="roman">close the database</span>
(dbm-close *db*)
</pre></td></tr></tbody></table>

<table class="menu" cellspacing="0" border="0">
<tbody><tr><td align="left" valign="top"><a href="#DBM_00e3_0083_0087_00e3_0083_00bc_00e3_0082_00bf_00e3_0083_0099_00e3_0083_00bc_00e3_0082_00b9_00e3_0081_00ae_00e3_0082_00aa_00e3_0083_00bc_00e3_0083_0097_00e3_0083_00b3_00e3_0081_00a8_00e3_0082_00af_00e3_0083_00ad_00e3_0083_00bc_00e3_0082_00ba">11.8.1 DBMデータベースのオープンとクローズ</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">  
</td></tr>
<tr><td align="left" valign="top"><a href="#DBM_00e3_0083_0087_00e3_0083_00bc_00e3_0082_00bf_00e3_0083_0099_00e3_0083_00bc_00e3_0082_00b9_00e3_0081_00ae_00e3_0082_00a2_00e3_0082_00af_00e3_0082_00bb_00e3_0082_00b9">11.8.2 DBMデータベースのアクセス</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">  
</td></tr>
<tr><td align="left" valign="top"><a href="#DBM_00e3_0083_0087_00e3_0083_00bc_00e3_0082_00bf_00e3_0083_0099_00e3_0083_00bc_00e3_0082_00b9_00e4_00b8_008a_00e3_0081_00ae_00e7_00b9_00b0_00e3_0082_008a_00e8_00bf_0094_00e3_0081_0097_00e5_0087_00a6_00e7_0090_0086">11.8.3 DBMデータベース上の繰り返し処理</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">  
</td></tr>
<tr><td align="left" valign="top"><a href="#DBM_00e3_0083_0087_00e3_0083_00bc_00e3_0082_00bf_00e3_0083_0099_00e3_0083_00bc_00e3_0082_00b9_00e3_0082_00a4_00e3_0083_00b3_00e3_0082_00b9_00e3_0082_00bf_00e3_0083_00b3_00e3_0082_00b9_00e3_0081_00ae_00e7_00ae_00a1_00e7_0090_0086">11.8.4 DBMデータベースインスタンスの管理</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">  
</td></tr>
<tr><td align="left" valign="top"><a href="#DBM_00e3_0083_0087_00e3_0083_00bc_00e3_0082_00bf_00e3_0083_0099_00e3_0083_00bc_00e3_0082_00b9_00e3_0081_00ae_00e3_0083_0080_00e3_0083_00b3_00e3_0083_0097_00e3_0081_00a8_00e3_0083_00aa_00e3_0082_00b9_00e3_0083_0088_00e3_0082_00a2">11.8.5 DBMデータベースのダンプとリストア</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">  
</td></tr>
<tr><td align="left" valign="top"><a href="#DBM_00e5_00ae_009f_00e8_00a3_0085_00e3_0082_0092_00e6_009b_00b8_00e3_0081_008f">11.8.6 DBM実装を書く</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">  
</td></tr>
</tbody></table>

<hr size="6">
<a name="DBM_00e3_0083_0087_00e3_0083_00bc_00e3_0082_00bf_00e3_0083_0099_00e3_0083_00bc_00e3_0082_00b9_00e3_0081_00ae_00e3_0082_00aa_00e3_0083_00bc_00e3_0083_0097_00e3_0083_00b3_00e3_0081_00a8_00e3_0082_00af_00e3_0083_00ad_00e3_0083_00bc_00e3_0082_00ba"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tbody><tr><td align="left" valign="middle">[<a href="#g_t_00e6_00b1_008e_00e7_0094_00a8DBM_00e3_0082_00a4_00e3_0083_00b3_00e3_0082_00bf_00e3_0083_0095_00e3_0082_00a7_00e3_0083_00bc_00e3_0082_00b9" title="Previous section in reading order"> &lt; </a>]</td>
<td align="left" valign="middle">[<a href="#DBM_00e3_0083_0087_00e3_0083_00bc_00e3_0082_00bf_00e3_0083_0099_00e3_0083_00bc_00e3_0082_00b9_00e3_0081_00ae_00e3_0082_00a2_00e3_0082_00af_00e3_0082_00bb_00e3_0082_00b9" title="Next section in reading order"> &gt; </a>]</td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_126.html#g_t_00e3_0083_00a9_00e3_0082_00a4_00e3_0083_0096_00e3_0083_00a9_00e3_0083_00aa_00e3_0083_00a2_00e3_0082_00b8_00e3_0083_00a5_00e3_0083_00bc_00e3_0083_00ab-_002d-_00e3_0083_00a6_00e3_0083_00bc_00e3_0083_0086_00e3_0082_00a3_00e3_0083_00aa_00e3_0083_0086_00e3_0082_00a3" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td align="left" valign="middle">[<a href="#g_t_00e6_00b1_008e_00e7_0094_00a8DBM_00e3_0082_00a4_00e3_0083_00b3_00e3_0082_00bf_00e3_0083_0095_00e3_0082_00a7_00e3_0083_00bc_00e3_0082_00b9" title="Up section"> Up </a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_189.html#g_t_00e5_008f_0082_00e8_0080_0083_00e6_0096_0087_00e7_008c_00ae" title="Next chapter"> &gt;&gt; </a>]</td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj.html#Top" title="Cover (top) of document">Top</a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_191.html#Index-_002d-_00e6_0089_008b_00e7_00b6_009a_00e3_0081_008d_00e3_0081_00a8_00e6_00a7_008b_00e6_0096_0087_00e7_00b4_00a2_00e5_00bc_0095" title="Index">Index</a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></tbody></table>
<a name="DBM_00e3_0083_0087_00e3_0083_00bc_00e3_0082_00bf_00e3_0083_0099_00e3_0083_00bc_00e3_0082_00b9_00e3_0081_00ae_00e3_0082_00aa_00e3_0083_00bc_00e3_0083_0097_00e3_0083_00b3_00e3_0081_00a8_00e3_0082_00af_00e3_0083_00ad_00e3_0083_00bc_00e3_0082_00ba-1"></a>
<h3 class="subsection">11.8.1 DBMデータベースのオープンとクローズ</h3>

<dl>
<dt><a name="index-_003cdbm_003e"></a><u>Class:</u> <b>&lt;dbm&gt;</b></dt>
<dd><a name="index-dbm-2"></a>
<p>DBM系のデータベースのための抽象クラスです。データベースへの共通のオペレーションを
定義します。以下のインスタンススロットを持ちます。これらのスロットの値は
<code>dbm-open</code>によってデータベースがオープンされる前にセットされて
いなければなりません。
</p>
<p>具体クラスは、データベースの操作をより細かく行うための追加のスロット(例えばロックを
行うかどうか)を持つかもしれません。
</p>
<dl>
<dt><a name="index-path-1"></a><u>Instance Variable of &lt;dbm&gt;:</u> <b>path</b></dt>
<dd><p>データベースファイルのパス名。dbmの実装によっては、このパスにサフィックスが追加されます。
</p></dd></dl>

<dl>
<dt><a name="index-rw_002dmode"></a><u>Instance Variable of &lt;dbm&gt;:</u> <b>rw-mode</b></dt>
<dd><p>読み書きのモードを指定します。以下の値のいずれかを取ります。
</p><dl compact="compact">
<dt> <code>:read</code></dt>
<dd><p>データベースは<code>dbm-open</code>によって読みだし専用モードでオープンされます。
オープンされる時点でデータベースは存在していなければなりません。
</p></dd>
<dt> <code>:write</code></dt>
<dd><p>データベースは<code>dbm-open</code>によって読み書き可能なモードでオープンされます。
データベースが存在しなければ、<code>dbm-open</code>は新しいデータベースを作成します。
</p></dd>
<dt> <code>:create</code></dt>
<dd><p><code>dbm-open</code>によって新しいデータベースが作成され、読み書き可能なモードでオープンされます。
既にデータベースが存在していた場合、その内容はクリアされます。
</p></dd>
</dl>
</dd></dl>

<dl>
<dt><a name="index-file_002dmode"></a><u>Instance Variable of &lt;dbm&gt;:</u> <b>file-mode</b></dt>
<dd><p>データベースが作成されるときのファイルパーミッションを指定します。
デフォルトは<code>#o664</code>です。
</p></dd></dl>

<dl>
<dt><a name="index-key_002dconvert"></a><u>Instance Variable of &lt;dbm&gt;:</u> <b>key-convert</b></dt>
<dt><a name="index-value_002dconvert"></a><u>Instance Variable of &lt;dbm&gt;:</u> <b>value-convert</b></dt>
<dd><p>デフォルトでは、dbmデータベースはキーにも値にも文字列しか使うことはできません。
これらのスロットによって、それ以外のSchemeオブジェクトを取り扱う方法を指定することが
できます。以下の値のいずれかが可能です。
</p><dl compact="compact">
<dt> <code>#f</code></dt>
<dd><p>デフォルトの値です。キーあるいは値は変換されません。それらは文字列でなければなりません。
</p></dd>
<dt> <code>#t</code></dt>
<dd><p>キーあるいは値は<code>write</code>を使って文字列に変換されデータベースに格納されます。
そして<code>read</code>を使って文字列からSchemeオブジェクトへと変換されます。
後で<code>read</code>で読みこめるようなキーあるいは値のみを扱うことができます。
(但し、dbmライブラリは書き込み時にそれが後で読み込めるかどうかのチェックは行いません)。
キーの比較は文字列に変換された後で行われるので、同じ値となるキーは同じ文字列表現を
持つ必要があります。
</p></dd>
<dt> 二つの手続きのリスト</dt>
<dd><p>どちらの手続きも一つの引数を取ります。最初の手続きはSchemeオブジェクトを受け取り、
文字列を返します。キーあるいは値をデータベースに格納する時に呼ばれます。
二つ目の手続きは文字列を受け取りSchemeオブジェクトを返します。データベースから
キーあるいは値を取り出す時に呼ばれます。
キーの比較は文字列に変換された後で行われるので、同じ値となるキーは同じ文字列に
変換される必要があります。
</p></dd>
</dl>
</dd></dl>
</dd></dl>

<dl>
<dt><a name="index-_003cdbm_002dmeta_003e"></a><u>Metaclass:</u> <b>&lt;dbm-meta&gt;</b></dt>
<dd><a name="index-dbm_002dmeta"></a>
<p><var>&lt;dbm&gt;</var>クラス及びそのサブクラスのメタクラスです。
</p></dd></dl>

<dl>
<dt><a name="index-dbm_002dopen"></a><u>Method:</u> <b>dbm-open</b><i> (dbm &lt;dbm&gt;)</i></dt>
<dd><p>DBMデータベースをオープンします。<var>dbm</var>は、<code>&lt;dbm&gt;</code>クラスを継承した
具体クラスのインスタンスでなければなりません。また、そのスロットには適切な値が
セットされている必要があります。オープンに成功したら<var>dbm</var>自身が返されます。
失敗した場合はエラーが報告されます。
</p></dd></dl>

<dl>
<dt><a name="index-dbm_002dopen-1"></a><u>Method:</u> <b>dbm-open</b><i> (dbm-class &lt;dbm-meta&gt;) options …</i></dt>
<dd><p>DBMインスタンスを作成してオープンするための便利なメソッドです。
次のように定義されます。
</p><table><tbody><tr><td>&nbsp;</td><td><pre class="example">(define-method dbm-open ((class &lt;class&gt;) . initargs)
  (dbm-open (apply make class initargs)))
</pre></td></tr></tbody></table>
</dd></dl>

<p>データベースファイルはガベージコレクトされる際にクローズされますが、
変更を正しくデータベースに反映するには、明示的にクローズした方が良いでしょう。
</p>
<dl>
<dt><a name="index-dbm_002dclose"></a><u>Method:</u> <b>dbm-close</b><i> (dbm <code>&lt;dbm&gt;</code>)</i></dt>
<dd><p>データベース<var>dbm</var>をクローズします。データベースがクローズされると、
それ以降のアクセスオペレーションはエラーとなります。
</p></dd></dl>

<dl>
<dt><a name="index-dbm_002dclosed_003f"></a><u>Method:</u> <b>dbm-closed?</b><i> (dbm <code>&lt;dbm&gt;</code>)</i></dt>
<dd><p>データベース<var>dbm</var>が既にクローズされていたら<code>#t</code>を返します。
</p></dd></dl>

<dl>
<dt><a name="index-dbm_002dtype_002d_003eclass"></a><u>Function:</u> <b>dbm-type-&gt;class</b><i> dbmtype</i></dt>
<dd><p>Sometimes you don’t know which type of dbm implementation you
need to use in your application beforehand, but rather you need to
determine the type according to the information given at run-time.
This procedure fulfills the need.
</p>
<p>The <var>dbmtype</var> argument is a symbol that names the type
of dbm implementation; for example, <code>gdbm</code> for <code>dbm.gdbm</code>,
and <code>fsdbm</code> for <code>dbm.fsdbm</code>.   We assume that the
dbm implementation of type <code><var>foo</var></code> is provided as
a module <code>dbm.<var>foo</var></code>, and its class is named
as <code>&lt;<var>foo</var>&gt;</code>.
</p>
<p>This procedure first checks if the required module has been
loaded, and if not, it tries to load it.   If the module
loads successfully, it returns the class object of the
named dbm implementation.   If it can’t load the module,
or can’t find the dbm class, this procedure returns #f.
</p>
<table><tbody><tr><td>&nbsp;</td><td><pre class="example">(use dbm)

(dbm-type-&gt;class 'gdbm)
  ⇒ <code>#&lt;class &lt;gdbm&gt;&gt;</code>

(dbm-type-&gt;class 'nosuchdbm)
  ⇒ <code>#f</code>
</pre></td></tr></tbody></table>
</dd></dl>

<hr size="6">
<a name="DBM_00e3_0083_0087_00e3_0083_00bc_00e3_0082_00bf_00e3_0083_0099_00e3_0083_00bc_00e3_0082_00b9_00e3_0081_00ae_00e3_0082_00a2_00e3_0082_00af_00e3_0082_00bb_00e3_0082_00b9"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tbody><tr><td align="left" valign="middle">[<a href="#DBM_00e3_0083_0087_00e3_0083_00bc_00e3_0082_00bf_00e3_0083_0099_00e3_0083_00bc_00e3_0082_00b9_00e3_0081_00ae_00e3_0082_00aa_00e3_0083_00bc_00e3_0083_0097_00e3_0083_00b3_00e3_0081_00a8_00e3_0082_00af_00e3_0083_00ad_00e3_0083_00bc_00e3_0082_00ba" title="Previous section in reading order"> &lt; </a>]</td>
<td align="left" valign="middle">[<a href="#DBM_00e3_0083_0087_00e3_0083_00bc_00e3_0082_00bf_00e3_0083_0099_00e3_0083_00bc_00e3_0082_00b9_00e4_00b8_008a_00e3_0081_00ae_00e7_00b9_00b0_00e3_0082_008a_00e8_00bf_0094_00e3_0081_0097_00e5_0087_00a6_00e7_0090_0086" title="Next section in reading order"> &gt; </a>]</td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_126.html#g_t_00e3_0083_00a9_00e3_0082_00a4_00e3_0083_0096_00e3_0083_00a9_00e3_0083_00aa_00e3_0083_00a2_00e3_0082_00b8_00e3_0083_00a5_00e3_0083_00bc_00e3_0083_00ab-_002d-_00e3_0083_00a6_00e3_0083_00bc_00e3_0083_0086_00e3_0082_00a3_00e3_0083_00aa_00e3_0083_0086_00e3_0082_00a3" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td align="left" valign="middle">[<a href="#g_t_00e6_00b1_008e_00e7_0094_00a8DBM_00e3_0082_00a4_00e3_0083_00b3_00e3_0082_00bf_00e3_0083_0095_00e3_0082_00a7_00e3_0083_00bc_00e3_0082_00b9" title="Up section"> Up </a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_189.html#g_t_00e5_008f_0082_00e8_0080_0083_00e6_0096_0087_00e7_008c_00ae" title="Next chapter"> &gt;&gt; </a>]</td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj.html#Top" title="Cover (top) of document">Top</a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_191.html#Index-_002d-_00e6_0089_008b_00e7_00b6_009a_00e3_0081_008d_00e3_0081_00a8_00e6_00a7_008b_00e6_0096_0087_00e7_00b4_00a2_00e5_00bc_0095" title="Index">Index</a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></tbody></table>
<a name="DBM_00e3_0083_0087_00e3_0083_00bc_00e3_0082_00bf_00e3_0083_0099_00e3_0083_00bc_00e3_0082_00b9_00e3_0081_00ae_00e3_0082_00a2_00e3_0082_00af_00e3_0082_00bb_00e3_0082_00b9-1"></a>
<h3 class="subsection">11.8.2 DBMデータベースのアクセス</h3>

<p>データベースがオープンされたら、以下のアクセスメソッドが使えます。
</p>
<dl>
<dt><a name="index-dbm_002dput_0021"></a><u>Method:</u> <b>dbm-put!</b><i> (dbm <code>&lt;dbm&gt;</code>) key value</i></dt>
<dd><p>値<var>value</var>をキー<var>key</var>と関連付けて保存します。
</p></dd></dl>

<dl>
<dt><a name="index-dbm_002dget"></a><u>Method:</u> <b>dbm-get</b><i> (dbm <code>&lt;dbm&gt;</code>) key :optional default</i></dt>
<dd><p>キー<var>key</var>に関連付けられた値を返します。もし値が存在しなければ、<var>default</var>が
与えられていればそれを返し、そうでなければエラーを報告します。
</p></dd></dl>

<dl>
<dt><a name="index-dbm_002dexists_003f"></a><u>Method:</u> <b>dbm-exists?</b><i> (dbm <code>&lt;dbm&gt;</code>) key</i></dt>
<dd><p>キー<var>key</var>に関連付けられた値が存在すれば<code>#t</code>を返します。
</p></dd></dl>

<dl>
<dt><a name="index-dbm_002ddelete_0021"></a><u>Method:</u> <b>dbm-delete!</b><i> (dbm <code>&lt;dbm&gt;</code>) key</i></dt>
<dd><p>キー<var>key</var>に関連付けられた値を消去します。値が存在しない場合は何もしません。
</p></dd></dl>

<hr size="6">
<a name="DBM_00e3_0083_0087_00e3_0083_00bc_00e3_0082_00bf_00e3_0083_0099_00e3_0083_00bc_00e3_0082_00b9_00e4_00b8_008a_00e3_0081_00ae_00e7_00b9_00b0_00e3_0082_008a_00e8_00bf_0094_00e3_0081_0097_00e5_0087_00a6_00e7_0090_0086"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tbody><tr><td align="left" valign="middle">[<a href="#DBM_00e3_0083_0087_00e3_0083_00bc_00e3_0082_00bf_00e3_0083_0099_00e3_0083_00bc_00e3_0082_00b9_00e3_0081_00ae_00e3_0082_00a2_00e3_0082_00af_00e3_0082_00bb_00e3_0082_00b9" title="Previous section in reading order"> &lt; </a>]</td>
<td align="left" valign="middle">[<a href="#DBM_00e3_0083_0087_00e3_0083_00bc_00e3_0082_00bf_00e3_0083_0099_00e3_0083_00bc_00e3_0082_00b9_00e3_0082_00a4_00e3_0083_00b3_00e3_0082_00b9_00e3_0082_00bf_00e3_0083_00b3_00e3_0082_00b9_00e3_0081_00ae_00e7_00ae_00a1_00e7_0090_0086" title="Next section in reading order"> &gt; </a>]</td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_126.html#g_t_00e3_0083_00a9_00e3_0082_00a4_00e3_0083_0096_00e3_0083_00a9_00e3_0083_00aa_00e3_0083_00a2_00e3_0082_00b8_00e3_0083_00a5_00e3_0083_00bc_00e3_0083_00ab-_002d-_00e3_0083_00a6_00e3_0083_00bc_00e3_0083_0086_00e3_0082_00a3_00e3_0083_00aa_00e3_0083_0086_00e3_0082_00a3" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td align="left" valign="middle">[<a href="#g_t_00e6_00b1_008e_00e7_0094_00a8DBM_00e3_0082_00a4_00e3_0083_00b3_00e3_0082_00bf_00e3_0083_0095_00e3_0082_00a7_00e3_0083_00bc_00e3_0082_00b9" title="Up section"> Up </a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_189.html#g_t_00e5_008f_0082_00e8_0080_0083_00e6_0096_0087_00e7_008c_00ae" title="Next chapter"> &gt;&gt; </a>]</td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj.html#Top" title="Cover (top) of document">Top</a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_191.html#Index-_002d-_00e6_0089_008b_00e7_00b6_009a_00e3_0081_008d_00e3_0081_00a8_00e6_00a7_008b_00e6_0096_0087_00e7_00b4_00a2_00e5_00bc_0095" title="Index">Index</a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></tbody></table>
<a name="DBM_00e3_0083_0087_00e3_0083_00bc_00e3_0082_00bf_00e3_0083_0099_00e3_0083_00bc_00e3_0082_00b9_00e4_00b8_008a_00e3_0081_00ae_00e7_00b9_00b0_00e3_0082_008a_00e8_00bf_0094_00e3_0081_0097_00e5_0087_00a6_00e7_0090_0086-1"></a>
<h3 class="subsection">11.8.3 DBMデータベース上の繰り返し処理</h3>

<p>全データベースを渡り歩く処理のために、以下のメソッドが用意されています。
</p>
<dl>
<dt><a name="index-dbm_002dfold"></a><u>Method:</u> <b>dbm-fold</b><i> (dbm <code>&lt;dbm&gt;</code>) procedure knil</i></dt>
<dd><p>基本的な繰り返し処理です。データベース内の各キー／値のペアに関して、手続き
<var>procedure</var>が <code>(<var>procedure</var> <var>key</var> <var>value</var> <var>r</var>)</code>,
のように呼ばれます。ここで<var>r</var>は、最初の<var>procedure</var>の呼び出しの時には<var>knil</var>
が、以降の呼び出しの時にはその直前の<var>procedure</var>が返した値が渡されます。
最後の<var>procedure</var>の戻り値が<code>dbm-fold</code>の戻り値となります。
データベース中にデータがひとつもなければ<var>knil</var>がそのまま返されます。
</p>
<p>次の例は、データベース中の整数の値を全て加算します。
</p><table><tbody><tr><td>&nbsp;</td><td><pre class="example">(dbm-fold dbm (lambda (k v r) (if (integer? v) (+ v r) r)) 0)
</pre></td></tr></tbody></table>
</dd></dl>

<dl>
<dt><a name="index-dbm_002dfor_002deach"></a><u>Method:</u> <b>dbm-for-each</b><i> (dbm <code>&lt;dbm&gt;</code>) procedure</i></dt>
<dd><p>データベース内の各キー／値のペアに関して、手続き<var>procedure</var>を呼び出します。
<var>procedure</var>にはキーと値が渡されます。<var>procedure</var>の戻り値は捨てられます。
</p></dd></dl>

<dl>
<dt><a name="index-dbm_002dmap"></a><u>Method:</u> <b>dbm-map</b><i> (dbm <code>&lt;dbm&gt;</code>) procedure</i></dt>
<dd><p>データベース内の各キー／値のペアに関して、手続き<var>procedure</var>を呼び出します。
<var>procedure</var>にはキーと値が渡されます。<var>procedure</var>の戻り値はリストに
集められて<code>dbm-map</code>の戻り値となります。
</p></dd></dl>

<hr size="6">
<a name="DBM_00e3_0083_0087_00e3_0083_00bc_00e3_0082_00bf_00e3_0083_0099_00e3_0083_00bc_00e3_0082_00b9_00e3_0082_00a4_00e3_0083_00b3_00e3_0082_00b9_00e3_0082_00bf_00e3_0083_00b3_00e3_0082_00b9_00e3_0081_00ae_00e7_00ae_00a1_00e7_0090_0086"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tbody><tr><td align="left" valign="middle">[<a href="#DBM_00e3_0083_0087_00e3_0083_00bc_00e3_0082_00bf_00e3_0083_0099_00e3_0083_00bc_00e3_0082_00b9_00e4_00b8_008a_00e3_0081_00ae_00e7_00b9_00b0_00e3_0082_008a_00e8_00bf_0094_00e3_0081_0097_00e5_0087_00a6_00e7_0090_0086" title="Previous section in reading order"> &lt; </a>]</td>
<td align="left" valign="middle">[<a href="#DBM_00e3_0083_0087_00e3_0083_00bc_00e3_0082_00bf_00e3_0083_0099_00e3_0083_00bc_00e3_0082_00b9_00e3_0081_00ae_00e3_0083_0080_00e3_0083_00b3_00e3_0083_0097_00e3_0081_00a8_00e3_0083_00aa_00e3_0082_00b9_00e3_0083_0088_00e3_0082_00a2" title="Next section in reading order"> &gt; </a>]</td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_126.html#g_t_00e3_0083_00a9_00e3_0082_00a4_00e3_0083_0096_00e3_0083_00a9_00e3_0083_00aa_00e3_0083_00a2_00e3_0082_00b8_00e3_0083_00a5_00e3_0083_00bc_00e3_0083_00ab-_002d-_00e3_0083_00a6_00e3_0083_00bc_00e3_0083_0086_00e3_0082_00a3_00e3_0083_00aa_00e3_0083_0086_00e3_0082_00a3" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td align="left" valign="middle">[<a href="#g_t_00e6_00b1_008e_00e7_0094_00a8DBM_00e3_0082_00a4_00e3_0083_00b3_00e3_0082_00bf_00e3_0083_0095_00e3_0082_00a7_00e3_0083_00bc_00e3_0082_00b9" title="Up section"> Up </a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_189.html#g_t_00e5_008f_0082_00e8_0080_0083_00e6_0096_0087_00e7_008c_00ae" title="Next chapter"> &gt;&gt; </a>]</td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj.html#Top" title="Cover (top) of document">Top</a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_191.html#Index-_002d-_00e6_0089_008b_00e7_00b6_009a_00e3_0081_008d_00e3_0081_00a8_00e6_00a7_008b_00e6_0096_0087_00e7_00b4_00a2_00e5_00bc_0095" title="Index">Index</a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></tbody></table>
<a name="DBM_00e3_0083_0087_00e3_0083_00bc_00e3_0082_00bf_00e3_0083_0099_00e3_0083_00bc_00e3_0082_00b9_00e3_0082_00a4_00e3_0083_00b3_00e3_0082_00b9_00e3_0082_00bf_00e3_0083_00b3_00e3_0082_00b9_00e3_0081_00ae_00e7_00ae_00a1_00e7_0090_0086-1"></a>
<h3 class="subsection">11.8.4 DBMデータベースインスタンスの管理</h3>

<p>各DBM実装は、データベースを格納するのに独自の方法を使います。
レガシーなDBMは、<var>path</var>スロットの値にそれぞれ‘<tt>.dir</tt>’と
‘<tt>.pag</tt>’を付けた名前の2つのファイルを使います。
<code>fsdbm</code>は<var>path</var>の下にディレクトリを作ります。
DBMデータベースが他のデータベースサーバによってバック
アップされる場合は、<var>path</var>はそのサーバで単なるキーと
して使われるでしょう。
</p>
<p>以下のメソッドは、そのようなバリエーションを隠し、
データベースそれ自体を管理する簡易な方法を提供します。
最初の引数に、具体的なDBMデータベースを実装している
クラスを渡す必要があります。
</p>
<dl>
<dt><a name="index-dbm_002ddb_002dexists_003f"></a><u>Generic Function:</u> <b>dbm-db-exists?</b><i> class name</i></dt>
<dd><p><var>name</var>で指定された<var>class</var>クラスのデータベースが
存在する場合は<code>#t</code>を返します。
</p>
<table><tbody><tr><td>&nbsp;</td><td><pre class="example">;; Returns #t if testdb.dir and testdb.pag exist
(dbm-db-exists? &lt;odbm&gt; "testdb")
</pre></td></tr></tbody></table>
</dd></dl>

<dl>
<dt><a name="index-dbm_002ddb_002dremove"></a><u>Generic Function:</u> <b>dbm-db-remove</b><i> class name</i></dt>
<dd><p><var>name</var>で指定される<var>class</var>クラスのデータベース
全体を削除します。
</p></dd></dl>

<dl>
<dt><a name="index-dbm_002ddb_002dcopy"></a><u>Generic Function:</u> <b>dbm-db-copy</b><i> class from to</i></dt>
<dd><p><var>from</var>で指定された<var>class</var>クラスのデータベースを
<var>to</var>へコピーします。
<var>class</var>のdbm実装がロックをサポートしている限り、<var>from</var>の一貫性は
保たれます (つまり、コピー中に他のプロセスが<var>from</var>を
変更しようとした場合であっても、<var>to</var>が壊れたデータベースになることは
ありません)。  もしコピー先の<var>to</var>が既に存在するデータベースで
あった場合、<var>to</var>の元の内容は失われます。
コピーが中断された場合に<var>to</var>が不完全な状態のままになるかどうかは
dbm実装に依存します。dbm実装の多くはトランザクショナルな振る舞い、
すなわち、コピーが失敗した場合に元の<var>to</var>を復元することを試みます。
しかし確実な操作のためには、コピーが失敗した場合には呼び出し側で<var>to</var>の
状態を確認することが必要です。
</p>
<table><tbody><tr><td>&nbsp;</td><td><pre class="example">(dbm-db-copy &lt;gdbm&gt; "testdb.dbm" "backup.dbm")
</pre></td></tr></tbody></table>
</dd></dl>

<dl>
<dt><a name="index-dbm_002ddb_002dmove"></a><u>Generic Function:</u> <b>dbm-db-move</b><i> class from to</i></dt>
<dd><p><var>from</var>で指定された<var>class</var>クラスのデータベースを
<var>to</var>へ移動、あるいはリネームします。<code>dbm-db-copy</code>と同じく、
<var>class</var>のdbm実装がロックをサポートしていれば
データベースの一貫性は保証されます。移動先の<var>to</var>が既に
存在していた場合、その元の内容は失われます。
</p></dd></dl>

<hr size="6">
<a name="DBM_00e3_0083_0087_00e3_0083_00bc_00e3_0082_00bf_00e3_0083_0099_00e3_0083_00bc_00e3_0082_00b9_00e3_0081_00ae_00e3_0083_0080_00e3_0083_00b3_00e3_0083_0097_00e3_0081_00a8_00e3_0083_00aa_00e3_0082_00b9_00e3_0083_0088_00e3_0082_00a2"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tbody><tr><td align="left" valign="middle">[<a href="#DBM_00e3_0083_0087_00e3_0083_00bc_00e3_0082_00bf_00e3_0083_0099_00e3_0083_00bc_00e3_0082_00b9_00e3_0082_00a4_00e3_0083_00b3_00e3_0082_00b9_00e3_0082_00bf_00e3_0083_00b3_00e3_0082_00b9_00e3_0081_00ae_00e7_00ae_00a1_00e7_0090_0086" title="Previous section in reading order"> &lt; </a>]</td>
<td align="left" valign="middle">[<a href="#DBM_00e5_00ae_009f_00e8_00a3_0085_00e3_0082_0092_00e6_009b_00b8_00e3_0081_008f" title="Next section in reading order"> &gt; </a>]</td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_126.html#g_t_00e3_0083_00a9_00e3_0082_00a4_00e3_0083_0096_00e3_0083_00a9_00e3_0083_00aa_00e3_0083_00a2_00e3_0082_00b8_00e3_0083_00a5_00e3_0083_00bc_00e3_0083_00ab-_002d-_00e3_0083_00a6_00e3_0083_00bc_00e3_0083_0086_00e3_0082_00a3_00e3_0083_00aa_00e3_0083_0086_00e3_0082_00a3" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td align="left" valign="middle">[<a href="#g_t_00e6_00b1_008e_00e7_0094_00a8DBM_00e3_0082_00a4_00e3_0083_00b3_00e3_0082_00bf_00e3_0083_0095_00e3_0082_00a7_00e3_0083_00bc_00e3_0082_00b9" title="Up section"> Up </a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_189.html#g_t_00e5_008f_0082_00e8_0080_0083_00e6_0096_0087_00e7_008c_00ae" title="Next chapter"> &gt;&gt; </a>]</td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj.html#Top" title="Cover (top) of document">Top</a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_191.html#Index-_002d-_00e6_0089_008b_00e7_00b6_009a_00e3_0081_008d_00e3_0081_00a8_00e6_00a7_008b_00e6_0096_0087_00e7_00b4_00a2_00e5_00bc_0095" title="Index">Index</a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></tbody></table>
<a name="DBM_00e3_0083_0087_00e3_0083_00bc_00e3_0082_00bf_00e3_0083_0099_00e3_0083_00bc_00e3_0082_00b9_00e3_0081_00ae_00e3_0083_0080_00e3_0083_00b3_00e3_0083_0097_00e3_0081_00a8_00e3_0083_00aa_00e3_0082_00b9_00e3_0083_0088_00e3_0082_00a2-1"></a>
<h3 class="subsection">11.8.5 DBMデータベースのダンプとリストア</h3>

<p>Most dbm implementations use some kind of binary format, and
some of them are architecture dependent.
That makes it difficult to pass around dbm databases
between different machines.
A safe way is to write out the content of a dbm database
into some portable format on the source machine,
and rebuild another dbm databse from it on the destination
machine.
</p>
<p>The operation is so common that Gauche provides convenience
scripts that does the job.  They are installed into the
standard Gauche library directory, so it can be invoked
by <code>gosh &lt;scriptname&gt;</code>.
</p>
<p>To write out the content of a dbm database named by <var>dbm-name</var>,
you can use <code>dbm/dump</code> script:
</p>
<table><tbody><tr><td>&nbsp;</td><td><pre class="example">$ gosh dbm/dump [-o <var>outfile</var>][-t <var>type</var>] <var>dbm-name</var>
</pre></td></tr></tbody></table>

<p>The <var>outfile</var> argument names the output file.  If omitted,
the output is written out to stdout.  The <var>type</var> argument
specifies the implementation type of the dbm database; e.g.
<code>gdbm</code> or <code>fsdbm</code>.  The program calls
<code>dbm-type-&gt;class</code> (See section <a href="#DBM_00e3_0083_0087_00e3_0083_00bc_00e3_0082_00bf_00e3_0083_0099_00e3_0083_00bc_00e3_0082_00b9_00e3_0081_00ae_00e3_0082_00aa_00e3_0083_00bc_00e3_0083_0097_00e3_0083_00b3_00e3_0081_00a8_00e3_0082_00af_00e3_0083_00ad_00e3_0083_00bc_00e3_0082_00ba">DBMデータベースのオープンとクローズ</a>)
on the <var>type</var> argument to load the necessary dbm implementation.
</p>
<p>The dumped format is simply a series of S-expressions,
each of which is a dotted pair of string key and string value.
Character encodings are assumed to be the same as
<code>gosh</code>’s native character encoding.
</p>
<p>The dumped output may contain S-expressions other than dotted pair
of strings to include meta information.  For now, programs
that deals with dumped output should just ignore S-expressions
other than dotted pairs.
</p>
<p>To read back the dumped dbm format, you can use <code>dbm/restore</code>
script:
</p>
<table><tbody><tr><td>&nbsp;</td><td><pre class="example">$ gosh dbm/restore [-i <var>infile</var>][-t <var>type</var>] <var>dbm-name</var>
</pre></td></tr></tbody></table>

<p>The <var>infile</var> argument names the dumped file to be read.
If omitted, it reads from stdin.  The <var>type</var> argument
specifies the dbm type, as in <code>dbm/dump</code> script.
The <var>dbm-name</var> argument names the dbm database; if the
database already exists, its content is cleared, so be careful.
</p>

<hr size="6">
<a name="DBM_00e5_00ae_009f_00e8_00a3_0085_00e3_0082_0092_00e6_009b_00b8_00e3_0081_008f"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tbody><tr><td align="left" valign="middle">[<a href="#DBM_00e3_0083_0087_00e3_0083_00bc_00e3_0082_00bf_00e3_0083_0099_00e3_0083_00bc_00e3_0082_00b9_00e3_0081_00ae_00e3_0083_0080_00e3_0083_00b3_00e3_0083_0097_00e3_0081_00a8_00e3_0083_00aa_00e3_0082_00b9_00e3_0083_0088_00e3_0082_00a2" title="Previous section in reading order"> &lt; </a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_135.html#g_t_00e3_0083_0095_00e3_0082_00a1_00e3_0082_00a4_00e3_0083_00ab_00e3_0082_00b7_00e3_0082_00b9_00e3_0083_0086_00e3_0083_00a0dbm" title="Next section in reading order"> &gt; </a>]</td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_126.html#g_t_00e3_0083_00a9_00e3_0082_00a4_00e3_0083_0096_00e3_0083_00a9_00e3_0083_00aa_00e3_0083_00a2_00e3_0082_00b8_00e3_0083_00a5_00e3_0083_00bc_00e3_0083_00ab-_002d-_00e3_0083_00a6_00e3_0083_00bc_00e3_0083_0086_00e3_0082_00a3_00e3_0083_00aa_00e3_0083_0086_00e3_0082_00a3" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td align="left" valign="middle">[<a href="#g_t_00e6_00b1_008e_00e7_0094_00a8DBM_00e3_0082_00a4_00e3_0083_00b3_00e3_0082_00bf_00e3_0083_0095_00e3_0082_00a7_00e3_0083_00bc_00e3_0082_00b9" title="Up section"> Up </a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_189.html#g_t_00e5_008f_0082_00e8_0080_0083_00e6_0096_0087_00e7_008c_00ae" title="Next chapter"> &gt;&gt; </a>]</td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj.html#Top" title="Cover (top) of document">Top</a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_191.html#Index-_002d-_00e6_0089_008b_00e7_00b6_009a_00e3_0081_008d_00e3_0081_00a8_00e6_00a7_008b_00e6_0096_0087_00e7_00b4_00a2_00e5_00bc_0095" title="Index">Index</a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></tbody></table>
<a name="DBM_00e5_00ae_009f_00e8_00a3_0085_00e3_0082_0092_00e6_009b_00b8_00e3_0081_008f-1"></a>
<h3 class="subsection">11.8.6 DBM実装を書く</h3>

<p>When you write an extension module that behaves like
a persistent hashtable, it is a good idea to adapt it
to the dbm interface, so that the application can use
the module in a generic way.
</p>
<p>The minimum procedures to conform the dbm interface
are as follow:
</p>
<ul>
<li>
Define a metaclass <code>&lt;<var>foo</var>-meta&gt;</code>.   It doesn’t
need to inherit anything except <code>&lt;class&gt;</code>.
</li><li>
Define a dbm class <code>&lt;<var>foo</var>&gt;</code> that inherits <code>&lt;dbm&gt;</code>
and whose metaclass is <code>&lt;<var>foo</var>-meta&gt;</code>.
</li><li>
Define methods for <code>dbm-open</code>, <code>dbm-close</code>,
<code>dbm-put!</code>, <code>dbm-get</code>, <code>dbm-exists</code>,
<code>dbm-delete!</code>, <code>dbm-fold</code>, <code>dbm-closed?</code>,
specialized for <code>&lt;<var>foo</var>&gt;</code>.
(The case of <code>dbm-open</code> for <code>&lt;<var>foo</var>-meta&gt;</code> is
handled automatically, so you don’t need to define it unless
you want something special).
Also note that the specialized <code>dbm-open</code> must call
<code>next-method</code> in it to set up dbm base class internals.
</li><li>
Define methods for <code>dbm-db-exists?</code> and
<code>dbm-db-remove</code> on <code>&lt;<var>foo</var>-meta&gt;</code>.
</li></ul>

<p>Besides above, you may define the following methods.
</p>
<ul>
<li>
Methods for <code>dbm-for-each</code> and <code>dbm-map</code>.
If you don’t define them, a generic implementation
by <code>dbm-fold</code> is used.  There may be an implementation
specific way which is more efficient.
</li><li>
Methods for <code>dbm-db-copy</code> and <code>dbm-db-move</code>.
If you don’t define them, a fallback method
opens the specified databases and copies elements one by
one, and removes the original if the method is  <code>dbm-db-move</code>.
Note that the fallback method is not only inefficient,
but also it may not copy any implementation-specific
meta information.  It is highly recommended for the
dbm implementation to provide these methods as well.
</li></ul>

<p>It is generally recommended to name the implementation module
as <code>dbm.<var>foo</var></code>, and the class of the implementation
as <code>&lt;<var>foo</var>&gt;</code>.  With this convention it is easier to
write an application that dynamically loads and uses
dbm implementation specified at runtime.
</p>
<hr size="6">
<table cellpadding="1" cellspacing="1" border="0">
<tbody><tr><td align="left" valign="middle">[<a href="#DBM_00e3_0083_0087_00e3_0083_00bc_00e3_0082_00bf_00e3_0083_0099_00e3_0083_00bc_00e3_0082_00b9_00e3_0081_00ae_00e3_0083_0080_00e3_0083_00b3_00e3_0083_0097_00e3_0081_00a8_00e3_0083_00aa_00e3_0082_00b9_00e3_0083_0088_00e3_0082_00a2" title="Previous section in reading order"> &lt; </a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_135.html#g_t_00e3_0083_0095_00e3_0082_00a1_00e3_0082_00a4_00e3_0083_00ab_00e3_0082_00b7_00e3_0082_00b9_00e3_0083_0086_00e3_0083_00a0dbm" title="Next section in reading order"> &gt; </a>]</td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_126.html#g_t_00e3_0083_00a9_00e3_0082_00a4_00e3_0083_0096_00e3_0083_00a9_00e3_0083_00aa_00e3_0083_00a2_00e3_0082_00b8_00e3_0083_00a5_00e3_0083_00bc_00e3_0083_00ab-_002d-_00e3_0083_00a6_00e3_0083_00bc_00e3_0083_0086_00e3_0082_00a3_00e3_0083_00aa_00e3_0083_0086_00e3_0082_00a3" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td align="left" valign="middle">[<a href="#g_t_00e6_00b1_008e_00e7_0094_00a8DBM_00e3_0082_00a4_00e3_0083_00b3_00e3_0082_00bf_00e3_0083_0095_00e3_0082_00a7_00e3_0083_00bc_00e3_0082_00b9" title="Up section"> Up </a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_189.html#g_t_00e5_008f_0082_00e8_0080_0083_00e6_0096_0087_00e7_008c_00ae" title="Next chapter"> &gt;&gt; </a>]</td>
</tr></tbody></table>
<p>
 <font size="-1">
  This document was generated by <em>Shiro Kawai</em> on <em>May 28, 2012</em> using <a href="http://www.nongnu.org/texi2html/"><em>texi2html 1.82</em></a>.
 </font>
 <br>

</p>




</body></html>
