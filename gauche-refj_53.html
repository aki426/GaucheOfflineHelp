<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html401/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=Shift_JIS">

<title>6.15 ハッシュテーブル</title>

<meta name="description" content="Gauche ユーザリファレンス: 6.15 ハッシュテーブル">
<meta name="keywords" content="Gauche ユーザリファレンス: 6.15 ハッシュテーブル">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="texi2html 1.82">




</head>
<body alink="#FF0000" bgcolor="#FFFFFF" lang="ja" link="#0000FF" text="#000000" vlink="#800080">

<a name="g_t_00e3_0083_008f_00e3_0083_0083_00e3_0082_00b7_00e3_0083_00a5_00e3_0083_0086_00e3_0083_00bc_00e3_0083_0096_00e3_0083_00ab"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tbody><tr><td align="left" valign="middle">[<a indepth="true" href="gauche-refj_52.html#g_t_00e3_0083_0099_00e3_0082_00af_00e3_0082_00bf" title="Previous section in reading order"> &lt; </a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_54.html#g_t_00e3_0083_0084_00e3_0083_00aa_00e3_0083_00bc_00e3_0083_009e_00e3_0083_0083_00e3_0083_0097" title="Next section in reading order"> &gt; </a>]</td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_38.html#g_t_00e7_00b5_0084_00e3_0081_00bf_00e8_00be_00bc_00e3_0081_00bf_00e3_0083_00a9_00e3_0082_00a4_00e3_0083_0096_00e3_0083_00a9_00e3_0083_00aa" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_38.html#g_t_00e7_00b5_0084_00e3_0081_00bf_00e8_00be_00bc_00e3_0081_00bf_00e3_0083_00a9_00e3_0082_00a4_00e3_0083_0096_00e3_0083_00a9_00e3_0083_00aa" title="Up section"> Up </a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_65.html#g_t_00e3_0082_00aa_00e3_0083_0096_00e3_0082_00b8_00e3_0082_00a7_00e3_0082_00af_00e3_0083_0088_00e3_0082_00b7_00e3_0082_00b9_00e3_0083_0086_00e3_0083_00a0" title="Next chapter"> &gt;&gt; </a>]</td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj.html#Top" title="Cover (top) of document">Top</a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_191.html#Index-_002d-_00e6_0089_008b_00e7_00b6_009a_00e3_0081_008d_00e3_0081_00a8_00e6_00a7_008b_00e6_0096_0087_00e7_00b4_00a2_00e5_00bc_0095" title="Index">Index</a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></tbody></table>
<a name="g_t_00e3_0083_008f_00e3_0083_0083_00e3_0082_00b7_00e3_0083_00a5_00e3_0083_0086_00e3_0083_00bc_00e3_0083_0096_00e3_0083_00ab-1"></a>
<h2 class="section">6.15 ハッシュテーブル</h2>

<dl>
<dt><a name="index-_003chash_002dtable_003e"></a><u>Builtin Class:</u> <b>&lt;hash-table&gt;</b></dt>
<dd><a name="index-hash_002dtable"></a>
<p>ハッシュテーブルのクラスです。<code>&lt;collection&gt;</code>と<code>&lt;dictionary&gt;</code>を
継承します。
</p></dd></dl>


<dl>
<dt><a name="index-make_002dhash_002dtable"></a><u>Function:</u> <b>make-hash-table</b><i> :optional type</i></dt>
<dd><p>ハッシュテーブルを作成します。シンボル<var>type</var>はテーブルのタイプを指定します。
現在、以下のようなタイプがサポートされています。
(<var>type</var>が省略された場合は<code>eq?</code>とみなされます。)
</p><dl compact="compact">
<dt> <code>eq?</code></dt>
<dd><p>キーの比較に<code>eq?</code>を使います。
</p></dd>
<dt> <code>eqv?</code></dt>
<dd><p>キーの比較に<code>eqv?</code>を使います。
</p></dd>
<dt> <code>equal?</code></dt>
<dd><p>キーの比較に<code>equal?</code>を使います。
</p></dd>
<dt> <code>string=?</code></dt>
<dd><p>キーの比較に<code>string=?</code>を使います。キーは文字列でなければなりません。
</p></dd>
</dl>

<p><code>eq?</code>、<code>eqv?</code>、<code>string=?</code>タイプのハッシュテーブルでは、
システム組み込みのハッシュ関数が使われます。Schemeからは、
それらのハッシュ関数はそれぞれ<code>eq-hash</code>、<code>eqv-hash</code>、
そしてSRFI-13の<code>string-hash</code>として呼ぶことができます。
これらの関数はユーザ定義型に対応するように拡張することはできません。
一方、<code>equal?</code>タイプのハッシュテーブルは
下に述べる<code>hash</code>関数を使います。後者では、ユーザ定義型に対するハッシュ関数を
独自に定義することができます。
</p>
</dd></dl>

<dl>
<dt><a name="index-hash"></a><u>Function:</u> <b>hash</b><i> obj</i></dt>
<dd><p><var>obj</var> のハッシュ値を返します。<code>equal?</code>-タイプのハッシュテーブルで
利用するハッシュ関数です。この関数が返すハッシュ値は正確な非負整数で、
以下の二つの性質があります。
</p><ul>
<li>
<var>a</var> および <var>b</var> の型について、<code>hash</code> が定義されているとき、
あらゆるオブジェクト <var>a</var> および  <var>b</var> に対して、
<code>(equal? <var>a</var> <var>b</var>)</code> であれば
<code>(= (hash <var>a</var>) (hash <var>b</var>))</code>。
</li><li>
<code>hash</code> は(そのデータのアドレスというような)実行時の計算機の状態とは
独立しています。それゆえ、その値をファイルに格納し、別のプロセスで読み込んで
利用しても、ハッシュ値の正当性を失うことがないので、安全です。
</li></ul>
<p><var>obj</var> が、数値、真理値、文字、シンボル、キーワード、文字列、リスト、
ベクタのいずれかならば、そのハッシュ値を求めるのには内部ハッシュ関数を
使います。
<var>obj</var> が、それ以外であれば、 <code>hash</code> は総称関数 <code>object-hash</code>
を呼んで、そのハッシュ値を計算します。
</p></dd></dl>

<dl>
<dt><a name="index-object_002dhash"></a><u>Generic Function:</u> <b>object-hash</b><i> obj</i></dt>
<dd><p>この総称関数に対するメソッドを定義することにより、ユーザ定義された
型のオブジェクトはハッシュ値を持つことができ、<code>equal?</code>型のハッシュ
テーブルで利用することができるようになります。
</p>
<p>メソッドは正確な非負整数を返さなければなりません。また、<code>hash</code> と
同じ制約に従わなければなりません。
</p>
<p>メソッドが <var>obj</var> の要素のハッシュ値を必要とする場合には、
それらに対しては、<code>object-hash</code> ではなく、<code>hash</code> を
呼ばなければなりません。プリミティブなオブジェクトのハッシュ計算は
<code>hash</code> が行うからです。
</p>
<table><tbody><tr><td>&nbsp;</td><td><pre class="example">(define-class &lt;myclass&gt; () (x y))

;; user-defined equality function
(define-method object-equal? ((a &lt;myclass&gt;) (b &lt;myclass&gt;))
  (and (equal? (ref a 'x) (ref b 'x))
       (eq?    (ref a 'y) (ref b 'y))))

;; user-defined hash function
(define-method object-hash ((a &lt;myclass&gt;))
  (hash (list (ref a 'x) (ref a 'y))))
</pre></td></tr></tbody></table>
</dd></dl>

<dl>
<dt><a name="index-eq_002dhash"></a><u>Function:</u> <b>eq-hash</b><i> obj</i></dt>
<dt><a name="index-eqv_002dhash"></a><u>Function:</u> <b>eqv-hash</b><i> obj</i></dt>
<dd><p>この2つは <code>eq?</code>-タイプおよび <code>eqv?</code>-タイプのハッシュテーブル
用のハッシュ関数で、2^<em>n</em>-1 以下の非負の整数を返します。ここで、
<em>n</em> は 32 以上のシステム依存の値です。返り値のハッシュ値は、
システムおよびプロセスに依存する値です。動作しているプロセスの境界を
超えてもちまわることはできません。
</p>
<p>注意: <code>eq-hash</code> をつかって、数をハッシュしてはいけません。
2つの数はたとえその値が等しくても <code>eq?</code> であることは保証されて
いません。したがって、<code>eq?</code>-タイプのハッシュテーブルで、
数のキーとしての使用はサポートされていません。
</p></dd></dl>

<dl>
<dt><a name="index-hash_002dtable_003f"></a><u>Function:</u> <b>hash-table?</b><i> obj</i></dt>
<dd><p><var>obj</var>がハッシュテーブルであれば<code>#t</code>を返します。
</p></dd></dl>

<dl>
<dt><a name="index-hash_002dtable_002dtype"></a><u>Function:</u> <b>hash-table-type</b><i> ht</i></dt>
<dd><p>ハッシュテーブル<var>ht</var>のタイプに応じて、シンボル
<code>eq?</code>、<code>eqv?</code>、<code>equal?</code>、<code>string=?</code>のいずれかを
返します。
</p></dd></dl>

<dl>
<dt><a name="index-hash_002dtable_002dnum_002dentries"></a><u>Function:</u> <b>hash-table-num-entries</b><i> ht</i></dt>
<dd><p>ハッシュテーブル<var>ht</var>中の要素の個数を返します。
</p></dd></dl>

<dl>
<dt><a name="index-hash_002dtable-1"></a><u>Function:</u> <b>hash-table</b><i> type key&amp;value …</i></dt>
<dd><p>与えられたキーと値の列からタイプが<var>type</var>であるハッシュテーブルを構築して
返します。<var>type</var>の意味は<code>make-hash-table</code>と同じです。
各<var>key&amp;value</var>はペアでなければならず、そのcarがキー、cdrが値として使われます。
</p>
<table><tbody><tr><td>&nbsp;</td><td><pre class="example">(hash-table 'eq? '(a . 1) '(b . 2))
  ≡
  (let ((h (make-hash-table 'eq?)))
     (hash-table-put! h 'a 1)
     (hash-table-put! h 'b 2)
     h)
</pre></td></tr></tbody></table>
</dd></dl>

<dl>
<dt><a name="index-hash_002dtable_002dget"></a><u>Function:</u> <b>hash-table-get</b><i> ht key :optional default</i></dt>
<dd><p>キー<var>key</var>をハッシュテーブル<var>ht</var>から探します。見つかればキーに対応する
値を返します。キーが見つからなかった場合、<var>default</var>が与えられていればそれを
返し、そうでなければエラーを報告します。
</p></dd></dl>

<dl>
<dt><a name="index-hash_002dtable_002dput_0021"></a><u>Function:</u> <b>hash-table-put!</b><i> ht key value</i></dt>
<dd><p>キー<var>key</var>と対応する値<var>value</var>をハッシュテーブル<var>ht</var>に挿入します。
</p></dd></dl>

<dl>
<dt><a name="index-ref"></a><u>Method:</u> <b>ref</b><i> (ht &lt;hash-table&gt;) key :optional default</i></dt>
<dt><a name="index-_0028setter-ref_0029"></a><u>Method:</u> <b>(setter ref)</b><i> (ht &lt;hash-table&gt;) key value</i></dt>
<dd><p><code>hash-table-get</code>と<code>hash-table-put!</code>のメソッド版です。
</p></dd></dl>

<dl>
<dt><a name="index-hash_002dtable_002dexists_003f"></a><u>Function:</u> <b>hash-table-exists?</b><i> ht key</i></dt>
<dd><p>ハッシュテーブル<var>ht</var>にキー<var>key</var>を持つエントリがあれば<code>#t</code>を返します。
</p></dd></dl>

<dl>
<dt><a name="index-hash_002dtable_002ddelete_0021"></a><u>Function:</u> <b>hash-table-delete!</b><i> ht key</i></dt>
<dd><p>ハッシュテーブル<code>ht</code>からキー<var>key</var>を持つエントリを削除します。
<var>key</var>を持つエントリが実際に存在して削除された場合は<code>#t</code>を、
エントリが存在しなかった場合は<code>#f</code>を返します。
この手続きはSTkで<code>hash-table-remove!</code>と呼ばれているものです
(STkのは戻り値が定義されていませんが)。GaucheではSRFI-1, SRFI-13やその他の
ライブラリとの一貫性のために ‘delete’ を採用しました。
</p></dd></dl>

<dl>
<dt><a name="index-hash_002dtable_002dclear_0021"></a><u>Function:</u> <b>hash-table-clear!</b><i> ht</i></dt>
<dd><p>ハッシュテーブル<var>ht</var>の全てのエントリを削除します。
</p></dd></dl>

<dl>
<dt><a name="index-hash_002dtable_002dpush_0021"></a><u>Function:</u> <b>hash-table-push!</b><i> ht key value</i></dt>
<dd><p>ハッシュテーブル<var>ht</var>中の、キー<var>key</var>に対応する値に<var>value</var>をコンスし、
それを<var>key</var>に対する新たな値とします。もし<var>key</var>に対応する値がまだ無ければ、
新たなエントリが作成され、<code>(list <var>value</var>)</code>がその値となります。
</p>
<p>この手続きは次のコードと同じ動作をしますが、キーの探索が一度しか行われないためより高速です。
</p><table><tbody><tr><td>&nbsp;</td><td><pre class="example">(hash-table-put! <var>ht</var> <var>key</var>
    (cons <var>value</var> (hash-table-get <var>ht</var> <var>key</var> '())))
</pre></td></tr></tbody></table>
</dd></dl>

<dl>
<dt><a name="index-hash_002dtable_002dpop_0021"></a><u>Function:</u> <b>hash-table-pop!</b><i> ht key :optional default</i></dt>
<dd><p>ハッシュテーブル<var>ht</var>中のキー<var>key</var>に対応する値が存在し、かつペアで
あった場合に、そのエントリーを元の値のcdrで置き換え、元の値のcarを返します。
<var>key</var>に対応する値が存在しないかペアではなかった場合、テーブルは変更されず、
<var>default</var>が与えられていればそれが返され、与えられていなければエラーが報告されます。
</p>
<p>値が置き換えれる場合でもキーの探索は一度しか行われないため効率が良いです。
</p></dd></dl>

<dl>
<dt><a name="index-hash_002dtable_002dupdate_0021"></a><u>Function:</u> <b>hash-table-update!</b><i> ht key proc :optional default</i></dt>
<dd><p><code>hash-table-push!</code>等のより一般的なバージョンです。
ハッシュテーブルの探索が一度しか行われないことを除いては、
基本的に次のように動作します。
</p><table><tbody><tr><td>&nbsp;</td><td><pre class="example">(let ((tmp (<var>proc</var> (hash-table-get <var>ht</var> <var>key</var> <var>default</var>))))
  (hash-table-put! <var>ht</var> <var>key</var> tmp)
  tmp)
</pre></td></tr></tbody></table>

<p>例えば、ハッシュテーブルを使ってオブジェクトの個数を数えているとしましょう。
次の1行で、オブジェクト<var>item</var>が既に出現したかどうかを気にせずに
その個数をインクリメントできます。
</p>
<table><tbody><tr><td>&nbsp;</td><td><pre class="example">(hash-table-update! ht item (cut + 1 &lt;&gt;) 0))
</pre></td></tr></tbody></table>

</dd></dl>


<dl>
<dt><a name="index-hash_002dtable_002dfor_002deach"></a><u>Function:</u> <b>hash-table-for-each</b><i> ht proc</i></dt>
<dt><a name="index-hash_002dtable_002dmap"></a><u>Function:</u> <b>hash-table-map</b><i> ht proc</i></dt>
<dd><p>ハッシュテーブル<var>ht</var>内の全てのエントリについて、各エントリのキーと値を
2つの引数として手続き<var>proc</var>を呼びます。
</p></dd></dl>

<dl>
<dt><a name="index-hash_002dtable_002dfold"></a><u>Function:</u> <b>hash-table-fold</b><i> ht kons knil</i></dt>
<dd><p>ハッシュテーブル<var>ht</var>内の全てのエントリについて<var>kons</var>を呼びます。
<var>kons</var>には3つの引数が渡されます。
各エントリのキーと値、および一つ前の<var>kons</var>の返り値です。
最初の<var>kons</var>の呼び出しの時には、第3引数に<var>knil</var>が渡されます。
最後の<var>kons</var>の返り値が<code>hash-table-fold</code>の返り値となります。
</p></dd></dl>

<dl>
<dt><a name="index-hash_002dtable_002dkeys"></a><u>Function:</u> <b>hash-table-keys</b><i> ht</i></dt>
<dt><a name="index-hash_002dtable_002dvalues"></a><u>Function:</u> <b>hash-table-values</b><i> ht</i></dt>
<dd><p>それぞれ、ハッシュテーブル<var>ht</var>内の全てのキーまたは値をリストにして返します。
</p></dd></dl>

<dl>
<dt><a name="index-alist_002d_003ehash_002dtable"></a><u>Function:</u> <b>alist-&gt;hash-table</b><i> alist :optional cmp</i></dt>
<dd><p>alistに含まれるそれぞれの要素をエントリとして持つハッシュテーブルを
作成して返します。その時、要素のcarがキーとして、要素のcdrが値として
使われます。<var>cmp</var>は作成されたハッシュテーブルの比較関数を
指定するシンボルで、現在は<code>eq?</code>、<code>eqv?</code>、<code>equal?</code>、
<code>string=?</code>がサポートされています。
</p></dd></dl>

<dl>
<dt><a name="index-hash_002dtable_002d_003ealist"></a><u>Function:</u> <b>hash-table-&gt;alist</b><i> hash-table</i></dt>
<dd><table><tbody><tr><td>&nbsp;</td><td><pre class="example">  (hash-table-map h cons)
</pre></td></tr></tbody></table>
</dd></dl>


<hr size="6">
<table cellpadding="1" cellspacing="1" border="0">
<tbody><tr><td align="left" valign="middle">[<a indepth="true" href="gauche-refj_52.html#g_t_00e3_0083_0099_00e3_0082_00af_00e3_0082_00bf" title="Previous section in reading order"> &lt; </a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_54.html#g_t_00e3_0083_0084_00e3_0083_00aa_00e3_0083_00bc_00e3_0083_009e_00e3_0083_0083_00e3_0083_0097" title="Next section in reading order"> &gt; </a>]</td>
<td align="left" valign="middle"> &nbsp; </td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_38.html#g_t_00e7_00b5_0084_00e3_0081_00bf_00e8_00be_00bc_00e3_0081_00bf_00e3_0083_00a9_00e3_0082_00a4_00e3_0083_0096_00e3_0083_00a9_00e3_0083_00aa" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_38.html#g_t_00e7_00b5_0084_00e3_0081_00bf_00e8_00be_00bc_00e3_0081_00bf_00e3_0083_00a9_00e3_0082_00a4_00e3_0083_0096_00e3_0083_00a9_00e3_0083_00aa" title="Up section"> Up </a>]</td>
<td align="left" valign="middle">[<a indepth="true" href="gauche-refj_65.html#g_t_00e3_0082_00aa_00e3_0083_0096_00e3_0082_00b8_00e3_0082_00a7_00e3_0082_00af_00e3_0083_0088_00e3_0082_00b7_00e3_0082_00b9_00e3_0083_0086_00e3_0083_00a0" title="Next chapter"> &gt;&gt; </a>]</td>
</tr></tbody></table>
<p>
 <font size="-1">
  This document was generated by <em>Shiro Kawai</em> on <em>May 28, 2012</em> using <a href="http://www.nongnu.org/texi2html/"><em>texi2html 1.82</em></a>.
 </font>
 <br>

</p>




</body></html>
